{% extends 'layout.html' %}

{% block title %}
Profile
{% endblock %}

{% block content %}
    <p class="text-3xl font-light">Welcome, {{ username }}!</p>
    <div class="liked-songs">
        <p class="text-7xl text-indigo-700 mb-6 font-semibold">Songle</p>
        <div class="liked-heading">
            <h2>Liked Songs</h2>
            <button id="toggleLikedSongs" class="collapse-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
                </svg>
            </button>           
        </div>
        <div id="likedSongsSection" class="liked-songs-section">
            {% for song in likedSongs %}
                <div class="liked-songs-list">
                    <div class="result flex justify-between items-center py-4 border-b border-gray-200">
                        <!-- <img src="{{ song.image }}" alt="Song Image"> -->
                        <div class="result-details">
                            <p><a href="{{ url_for('song_details', id=song.id) }}" style="color: #3b82f6; text-decoration: underline; transition: color 0.3s;" onmouseover="this.style.color='#1d4ed8'" onmouseout="this.style.color='#3b82f6'">{{ song.title }}</a></p>
                            <p>Artist: {{ song.artist }}</p>
                            <!-- <p>{{ song.lyric_sentence }}</p> -->
                        </div>
                        <form method="post" action="{{ url_for('deleteSong') }}">
                            <input type="hidden" name="song_id" value="{{ song.id }}">
                            <button type="submit" class="remove-button">Remove</button>
                        </form>
                    </div>
                </div>
                <hr> <!-- Line separating each song -->
            {% endfor %}
        </div>
        <h2 class="liked-heading">Recommended Songs</h2>
        {% for song in recommendedSongs %}
            <div class="result flex justify-between items-center py-4 border-b border-gray-200">
                <div class="result-details">
                    <p><a href="{{ url_for('song_details', id=song.id) }}" style="color: #3b82f6; text-decoration: underline; transition: color 0.3s;" onmouseover="this.style.color='#1d4ed8'" onmouseout="this.style.color='#3b82f6'">{{ song.title }}</a></p>
                    <p>Artist: {{ song.artist }}</p>
                </div>
                <!-- Add a form with a button to save the song -->
                <form method="post" action="{{ url_for('saveSong') }}">
                    <input type="hidden" name="song_id" value="{{ song.id }}">
                    <button type="submit" class="add-button">Add to Liked Songs</button>
                </form>
            </div>
            <hr> <!-- Line separating each song -->
        {% endfor %}
    </div>
    {% if error %}
    <script>
        window.onload = function() {
            alert('{{ error }}');
        };
    </script>
    {% endif %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggleButton = document.getElementById('toggleLikedSongs');
            const likedSongsSection = document.getElementById('likedSongsSection');
            
            let likedShowing = true; // Initialize as true since liked section is initially showing
            
            // Function to toggle the liked songs section and update chevron icon
            function toggleLikedSongsSection() {
                likedShowing = !likedShowing; // Toggle likedShowing variable
                likedSongsSection.style.display = likedShowing ? 'block' : 'none'; // Toggle display
                
                // Update chevron icon
                toggleButton.innerHTML = likedShowing ? `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
                    </svg>
                ` : `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708"/>
                    </svg>
                `;
            }
            
            // Event listener for the toggle button
            toggleButton.addEventListener('click', toggleLikedSongsSection);
        });
    </script>
    
{% endblock %}

<style>
    .link {
        color: grey;
        text-decoration: none;
        transition: color 0.3s;
    }

    .link:hover {
        color: #3b82f6; /* Darker grey on hover */
    }


    .liked-songs-list {
        margin-bottom: 20px; /* Adjust spacing between songs */
    }

    hr {
        border: none;
        border-top: 1px solid #ccc;
        margin: 10px 0; /* Adjust spacing between lines */
    }
</style>
